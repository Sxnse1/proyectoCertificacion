<!DOCTYPE html><!DOCTYPE html><!DOCTYPE html>

<html lang="es">

<head><html lang="es"><html lang="es">

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0"><head><head>

    <title>Historial de Pagos - StartEducation</title>

        <meta charset="UTF-8">    <meta charset="UTF-8">

    <!-- Favicon -->

    <link rel="icon" type="image/svg+xml" href="/images/favicon.svg">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    <!-- Bootstrap 5.3 CSS -->    <title>Historial de Pagos - Administración</title>    <title>Historial de Pagos - Admin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Google Fonts -->    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">    <style>

    <style>

        :root {    <style>        :root {

            --primary-color: #ea580c;

            --primary-hover: #c2410c;        :root {            --primary-color: #FF6B35;

            --success-color: #10b981;

            --warning-color: #f59e0b;            --primary-orange: #ea580c;            --secondary-color: #004E89;

            --danger-color: #ef4444;

            --text-dark: #1f2937;            --orange-hover: #c2410c;        }

            --text-muted: #6b7280;

            --border-color: #e5e7eb;            --orange-light: #fed7aa;

            --bg-light: #f8fafc;

        }            --orange-lighter: #ffedd5;        body {



        * {            --dark-gray: #1f2937;            background: #f5f6fa;

            font-family: 'Inter', sans-serif;

        }            --medium-gray: #6b7280;            font-family: 'Inter', sans-serif;



        body {            --light-gray: #f3f4f6;        }

            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);

            color: var(--text-dark);            --border-color: #e5e7eb;

            min-height: 100vh;

        }        }        .admin-header {



        .main-container {            background: linear-gradient(135deg, var(--secondary-color), #003366);

            max-width: 1400px;

            margin: 0 auto;        * {            color: white;

            padding: 2rem;

        }            margin: 0;            padding: 30px 0;



        .header-section {            padding: 0;            margin-bottom: 30px;

            background: white;

            border-radius: 16px;            box-sizing: border-box;            box-shadow: 0 4px 6px rgba(0,0,0,0.1);

            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);

            padding: 2rem;        }        }

            margin-bottom: 2rem;

            border-left: 5px solid var(--primary-color);

        }

        body {        .stats-grid {

        .header-title {

            display: flex;            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;            display: grid;

            align-items: center;

            justify-content: space-between;            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));

            flex-wrap: wrap;

            gap: 1rem;            min-height: 100vh;            gap: 20px;

        }

            padding: 2rem;            margin-bottom: 30px;

        .header-title h1 {

            color: var(--text-dark);        }        }

            font-weight: 700;

            margin: 0;

            display: flex;

            align-items: center;        .container-fluid {        .stat-card {

            gap: 0.75rem;

        }            max-width: 1400px;            background: white;



        .stats-row {        }            padding: 25px;

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));            border-radius: 15px;

            gap: 1.5rem;

            margin-top: 1.5rem;        .header {            box-shadow: 0 2px 10px rgba(0,0,0,0.08);

        }

            background: white;        }

        .stat-card {

            background: var(--bg-light);            border-radius: 16px;

            border-radius: 12px;

            padding: 1.5rem;            padding: 2rem;        .stat-icon {

            text-align: center;

            border: 1px solid var(--border-color);            margin-bottom: 2rem;            width: 60px;

            transition: transform 0.2s ease;

        }            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);            height: 60px;



        .stat-card:hover {        }            background: linear-gradient(135deg, var(--primary-color), #F7931E);

            transform: translateY(-2px);

        }            border-radius: 12px;



        .stat-number {        .header h1 {            display: flex;

            font-size: 2rem;

            font-weight: 700;            color: var(--dark-gray);            align-items: center;

            color: var(--primary-color);

            display: block;            font-size: 2rem;            justify-content: center;

        }

            font-weight: 700;            margin-bottom: 15px;

        .stat-label {

            color: var(--text-muted);            margin: 0;            color: white;

            font-size: 0.9rem;

            margin-top: 0.5rem;            display: flex;            font-size: 1.5rem;

        }

            align-items: center;        }

        .controls-section {

            background: white;            gap: 0.75rem;

            border-radius: 16px;

            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);        }        .stat-value {

            padding: 1.5rem;

            margin-bottom: 2rem;            font-size: 2rem;

        }

        .header h1 i {            font-weight: 700;

        .controls-row {

            display: flex;            color: var(--primary-orange);            color: var(--secondary-color);

            justify-content: space-between;

            align-items: center;            font-size: 2.5rem;        }

            flex-wrap: wrap;

            gap: 1rem;        }

        }

        .stat-label {

        .search-group {

            display: flex;        .stats-grid {            color: #6c757d;

            gap: 0.5rem;

            flex: 1;            display: grid;            font-size: 0.9rem;

            max-width: 400px;

        }            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));        }



        .search-input {            gap: 1.5rem;

            border: 2px solid var(--border-color);

            border-radius: 8px;            margin-bottom: 2rem;        .content-card {

            padding: 0.75rem 1rem;

            font-size: 0.95rem;        }            background: white;

            transition: border-color 0.3s ease;

        }            border-radius: 15px;



        .search-input:focus {        .stat-card {            padding: 30px;

            border-color: var(--primary-color);

            box-shadow: 0 0 0 0.2rem rgba(234, 88, 12, 0.25);            background: white;            box-shadow: 0 2px 10px rgba(0,0,0,0.08);

        }

            border-radius: 12px;            margin-bottom: 30px;

        .btn-primary {

            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);            padding: 1.5rem;        }

            border: none;

            border-radius: 8px;            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);

            font-weight: 600;

            padding: 0.75rem 1.5rem;            transition: all 0.3s ease;        .filter-section {

            transition: all 0.3s ease;

        }            border-left: 4px solid var(--primary-orange);            background: #f8f9fa;



        .btn-primary:hover {        }            padding: 20px;

            background: linear-gradient(135deg, var(--primary-hover) 0%, #9a3412 100%);

            transform: translateY(-2px);            border-radius: 10px;

            box-shadow: 0 8px 20px rgba(234, 88, 12, 0.4);

        }        .stat-card:hover {            margin-bottom: 25px;



        .btn-success {            transform: translateY(-4px);        }

            background: var(--success-color);

            border: none;            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);

            border-radius: 8px;

            font-weight: 600;        }        .table-custom thead {

            padding: 0.75rem 1.5rem;

            transition: all 0.3s ease;            background: #f8f9fa;

        }

        .stat-label {        }

        .btn-success:hover {

            background: #059669;            color: var(--medium-gray);

            transform: translateY(-2px);

        }            font-size: 0.875rem;        .table-custom th {



        .btn-warning {            font-weight: 500;            font-weight: 600;

            background: var(--warning-color);

            border: none;            text-transform: uppercase;            color: var(--secondary-color);

            border-radius: 8px;

            color: white;            letter-spacing: 0.5px;            padding: 15px;

            font-weight: 600;

            padding: 0.5rem 1rem;            margin-bottom: 0.5rem;        }

            transition: all 0.3s ease;

        }        }



        .btn-warning:hover {        .table-custom td {

            background: #d97706;

            color: white;        .stat-value {            padding: 15px;

        }

            color: var(--dark-gray);            vertical-align: middle;

        .btn-danger {

            background: var(--danger-color);            font-size: 2rem;        }

            border: none;

            border-radius: 8px;            font-weight: 700;

            font-weight: 600;

            padding: 0.5rem 1rem;            display: flex;        .status-completado {

            transition: all 0.3s ease;

        }            align-items: center;            background: #d4edda;



        .btn-danger:hover {            gap: 0.5rem;            color: #155724;

            background: #dc2626;

        }        }            padding: 6px 12px;



        .table-section {            border-radius: 20px;

            background: white;

            border-radius: 16px;        .stat-icon {            font-weight: 600;

            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);

            overflow: hidden;            background: var(--orange-lighter);            font-size: 0.85rem;

        }

            color: var(--primary-orange);        }

        .table-header {

            background: var(--bg-light);            width: 48px;

            padding: 1.5rem;

            border-bottom: 1px solid var(--border-color);            height: 48px;        .status-pendiente {

        }

            border-radius: 12px;            background: #fff3cd;

        .table {

            margin: 0;            display: flex;            color: #856404;

        }

            align-items: center;            padding: 6px 12px;

        .table th {

            background: var(--bg-light);            justify-content: center;            border-radius: 20px;

            border: none;

            font-weight: 600;            font-size: 1.5rem;            font-weight: 600;

            color: var(--text-dark);

            padding: 1rem;        }            font-size: 0.85rem;

        }

        }

        .table td {

            border: none;        .content-card {

            padding: 1rem;

            vertical-align: middle;            background: white;        .status-fallido {

        }

            border-radius: 16px;            background: #f8d7da;

        .table tbody tr {

            border-bottom: 1px solid #f1f5f9;            padding: 2rem;            color: #721c24;

            transition: background-color 0.2s ease;

        }            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);            padding: 6px 12px;



        .table tbody tr:hover {            margin-bottom: 2rem;            border-radius: 20px;

            background-color: rgba(234, 88, 12, 0.05);

        }        }            font-weight: 600;



        .badge {            font-size: 0.85rem;

            font-size: 0.75rem;

            padding: 0.35rem 0.65rem;        .card-header-custom {        }

        }

            display: flex;

        .actions-group {

            display: flex;            justify-content: space-between;        .chart-container {

            gap: 0.5rem;

        }            align-items: center;            height: 300px;



        .pagination-section {            margin-bottom: 1.5rem;            margin-bottom: 30px;

            background: white;

            border-radius: 16px;            padding-bottom: 1rem;        }

            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);

            padding: 1.5rem;            border-bottom: 2px solid var(--light-gray);

            margin-top: 2rem;

        }        }        .payment-method-badge {



        .pagination {            padding: 4px 10px;

            margin: 0;

            justify-content: center;        .card-title {            border-radius: 15px;

        }

            color: var(--dark-gray);            font-size: 0.85rem;

        .page-link {

            border: none;            font-size: 1.5rem;            font-weight: 600;

            color: var(--text-muted);

            padding: 0.75rem 1rem;            font-weight: 600;        }

            margin: 0 0.25rem;

            border-radius: 8px;            margin: 0;

            transition: all 0.3s ease;

        }        }        .method-stripe {



        .page-link:hover {            background: #635bff;

            background: var(--primary-color);

            color: white;        .filters-section {            color: white;

        }

            display: flex;        }

        .page-item.active .page-link {

            background: var(--primary-color);            gap: 1rem;

            color: white;

        }            flex-wrap: wrap;        .method-paypal {



        .empty-state {            margin-bottom: 1.5rem;            background: #0070ba;

            text-align: center;

            padding: 4rem 2rem;        }            color: white;

            color: var(--text-muted);

        }        }



        .empty-state i {        .search-box {

            font-size: 4rem;

            margin-bottom: 1rem;            flex: 1;        .method-transferencia {

            opacity: 0.5;

        }            min-width: 250px;            background: #28a745;



        .loading-overlay {        }            color: white;

            position: fixed;

            top: 0;        }

            left: 0;

            right: 0;        .search-box input {    </style>

            bottom: 0;

            background: rgba(255, 255, 255, 0.95);            width: 100%;</head>

            display: none;

            align-items: center;            padding: 0.75rem 1rem;<body>

            justify-content: center;

            z-index: 9999;            border: 2px solid var(--border-color);    <div class="admin-header">

        }

            border-radius: 8px;        <div class="container-fluid">

        .spinner-border {

            color: var(--primary-color);            font-size: 0.95rem;            <div class="d-flex justify-content-between align-items-center">

        }

            transition: all 0.3s ease;                <div>

        .filter-select {

            border: 2px solid var(--border-color);        }                    <h1><i class="fas fa-file-invoice-dollar"></i> Historial de Pagos</h1>

            border-radius: 8px;

            padding: 0.75rem 1rem;                    <p class="mb-0">Control completo de transacciones y pagos</p>

            font-size: 0.95rem;

            transition: border-color 0.3s ease;        .search-box input:focus {                </div>

            min-width: 150px;

        }            outline: none;                <a href="/admin/dashboard" class="btn btn-light btn-lg">



        .filter-select:focus {            border-color: var(--primary-orange);                    <i class="fas fa-arrow-left"></i> Dashboard

            border-color: var(--primary-color);

            box-shadow: 0 0 0 0.2rem rgba(234, 88, 12, 0.25);            box-shadow: 0 0 0 3px var(--orange-lighter);                </a>

        }

        }            </div>

        @media (max-width: 768px) {

            .main-container {        </div>

                padding: 1rem;

            }        .filter-select {    </div>

            

            .header-section {            padding: 0.75rem 1rem;

                padding: 1.5rem;

            }            border: 2px solid var(--border-color);    <div class="container-fluid">

            

            .controls-row {            border-radius: 8px;        <!-- Stats -->

                flex-direction: column;

                align-items: stretch;            font-size: 0.95rem;        <div class="stats-grid">

            }

                        background: white;            <div class="stat-card">

            .search-group {

                max-width: none;            transition: all 0.3s ease;                <div class="stat-icon">

            }

                        min-width: 150px;                    <i class="fas fa-dollar-sign"></i>

            .actions-group {

                justify-content: center;        }                </div>

            }

                            <div class="stat-value">${{totalIngresos}}</div>

            .table-responsive {

                font-size: 0.9rem;        .filter-select:focus {                <div class="stat-label">Ingresos Totales</div>

            }

        }            outline: none;            </div>

    </style>

</head>            border-color: var(--primary-orange);            <div class="stat-card">

<body>

    <!-- Loading Overlay -->            box-shadow: 0 0 0 3px var(--orange-lighter);                <div class="stat-icon">

    <div class="loading-overlay" id="loadingOverlay">

        <div class="text-center">        }                    <i class="fas fa-calendar-day"></i>

            <div class="spinner-border mb-3" role="status">

                <span class="visually-hidden">Cargando...</span>                </div>

            </div>

            <p>Procesando...</p>        .table-responsive {                <div class="stat-value">${{ingresosMes}}</div>

        </div>

    </div>            border-radius: 8px;                <div class="stat-label">Ingresos Este Mes</div>



    <div class="main-container">            overflow: hidden;            </div>

        <!-- Header Section -->

        <div class="header-section">        }            <div class="stat-card">

            <div class="header-title">

                <h1>                <div class="stat-icon">

                    <i class="bi bi-credit-card-2-front"></i>

                    Historial de Pagos        .table {                    <i class="fas fa-chart-line"></i>

                </h1>

                <div class="d-flex gap-2">            margin: 0;                </div>

                    <a href="/dashboard" class="btn btn-outline-secondary">

                        <i class="bi bi-arrow-left me-2"></i>Dashboard        }                <div class="stat-value">{{totalTransacciones}}</div>

                    </a>

                </div>                <div class="stat-label">Total Transacciones</div>

            </div>

                    .table thead {            </div>

            <!-- Estadísticas -->

            <div class="stats-row">            background: var(--light-gray);            <div class="stat-card">

                <div class="stat-card">

                    <span class="stat-number">${{totalIngresos}}</span>        }                <div class="stat-icon">

                    <div class="stat-label">Total Ingresos</div>

                </div>                    <i class="fas fa-percentage"></i>

                <div class="stat-card">

                    <span class="stat-number">${{ingresosMes}}</span>        .table thead th {                </div>

                    <div class="stat-label">Ingresos Este Mes</div>

                </div>            color: var(--dark-gray);                <div class="stat-value">{{tasaExito}}%</div>

                <div class="stat-card">

                    <span class="stat-number">{{totalTransacciones}}</span>            font-weight: 600;                <div class="stat-label">Tasa de Éxito</div>

                    <div class="stat-label">Total Transacciones</div>

                </div>            text-transform: uppercase;            </div>

                <div class="stat-card">

                    <span class="stat-number">{{tasaExito}}%</span>            font-size: 0.75rem;        </div>

                    <div class="stat-label">Tasa de Éxito</div>

                </div>            letter-spacing: 0.5px;

            </div>

        </div>            padding: 1rem;        <div class="row">



        <!-- Controls Section -->            border: none;            <div class="col-lg-8">

        <div class="controls-section">

            <div class="controls-row">        }                <div class="content-card">

                <div class="search-group">

                    <input type="text"                     <h2 class="mb-4"><i class="fas fa-list"></i> Todas las Transacciones</h2>

                           class="form-control search-input" 

                           id="searchInput"        .table tbody td {

                           placeholder="Buscar por usuario, email, concepto...">

                    <button type="button" class="btn btn-primary" onclick="filtrarTabla()">            padding: 1rem;                    <!-- Filtros -->

                        <i class="bi bi-search"></i>

                    </button>            vertical-align: middle;                    <div class="filter-section">

                </div>

                <div class="d-flex gap-2">            color: var(--dark-gray);                        <div class="row">

                    <select id="estatusFilter" class="filter-select" onchange="filtrarTabla()">

                        <option value="">Todos los Estatus</option>            border-bottom: 1px solid var(--border-color);                            <div class="col-md-3 mb-3">

                        <option value="exitoso">Exitoso</option>

                        <option value="fallido">Fallido</option>        }                                <label class="form-label">Estado</label>

                        <option value="reembolsado">Reembolsado</option>

                    </select>                                <select class="form-select" id="filtroEstado" onchange="filtrarPagos()">

                    <select id="tipoFilter" class="filter-select" onchange="filtrarTabla()">

                        <option value="">Todos los Tipos</option>        .table tbody tr:last-child td {                                    <option value="">Todos</option>

                        <option value="Compra de Curso">Compra de Curso</option>

                        <option value="Suscripción">Suscripción</option>            border-bottom: none;                                    <option value="completado">Completado</option>

                        <option value="Otro">Otro</option>

                    </select>        }                                    <option value="pendiente">Pendiente</option>

                </div>

            </div>                                    <option value="fallido">Fallido</option>

        </div>

        .table tbody tr:hover {                                </select>

        <!-- Distribución por Estatus -->

        {{#if distribucionEstatus}}            background: var(--orange-lighter);                            </div>

        <div class="table-section mb-4">

            <div class="table-header">        }                            <div class="col-md-3 mb-3">

                <h5 class="mb-0">

                    <i class="bi bi-pie-chart me-2"></i>                                <label class="form-label">Método</label>

                    Distribución por Estatus

                </h5>        .badge-status {                                <select class="form-select" id="filtroMetodo" onchange="filtrarPagos()">

            </div>

            <div class="p-3">            padding: 0.5rem 1rem;                                    <option value="">Todos</option>

                <div class="row">

                    {{#each distribucionEstatus}}            border-radius: 6px;                                    <option value="stripe">Stripe</option>

                    <div class="col-md-4 mb-3">

                        <div class="card h-100">            font-weight: 500;                                    <option value="paypal">PayPal</option>

                            <div class="card-body text-center">

                                <h6 class="card-title text-capitalize">{{this.estatus}}</h6>            font-size: 0.875rem;                                    <option value="transferencia">Transferencia</option>

                                <h4 class="text-primary">{{this.cantidad}}</h4>

                                <p class="card-text text-muted">${{this.total}}</p>            display: inline-block;                                </select>

                            </div>

                        </div>        }                            </div>

                    </div>

                    {{/each}}                            <div class="col-md-3 mb-3">

                </div>

            </div>        .badge-exitoso {                                <label class="form-label">Fecha Desde</label>

        </div>

        {{/if}}            background: #dcfce7;                                <input type="date" class="form-control" id="fechaDesde" onchange="filtrarPagos()">



        <!-- Top Compradores -->            color: #166534;                            </div>

        {{#if topCompradores}}

        <div class="table-section mb-4">        }                            <div class="col-md-3 mb-3">

            <div class="table-header">

                <h5 class="mb-0">                                <label class="form-label">Fecha Hasta</label>

                    <i class="bi bi-trophy me-2"></i>

                    Top 10 Compradores        .badge-fallido {                                <input type="date" class="form-control" id="fechaHasta" onchange="filtrarPagos()">

                </h5>

            </div>            background: #fee2e2;                            </div>

            <div class="table-responsive">

                <table class="table">            color: #991b1b;                        </div>

                    <thead>

                        <tr>        }                        <div class="row">

                            <th>Usuario</th>

                            <th>Email</th>                            <div class="col-md-6 mb-3">

                            <th>Transacciones</th>

                            <th>Total Gastado</th>        .badge-reembolsado {                                <input type="text" class="form-control" id="buscarTransaccion" 

                        </tr>

                    </thead>            background: #fef3c7;                                       placeholder="Buscar por ID de transacción, usuario..." onkeyup="buscar()">

                    <tbody>

                        {{#each topCompradores}}            color: #92400e;                            </div>

                        <tr>

                            <td><strong>{{this.nombre}}</strong></td>        }                            <div class="col-md-6 mb-3 d-flex gap-2">

                            <td>{{this.email}}</td>

                            <td>{{this.cantidad_transacciones}}</td>                                <button class="btn btn-primary flex-grow-1" onclick="exportarExcel()">

                            <td><strong>${{this.total_gastado}}</strong></td>

                        </tr>        .btn-primary-custom {                                    <i class="fas fa-file-excel"></i> Exportar Excel

                        {{/each}}

                    </tbody>            background: var(--primary-orange);                                </button>

                </table>

            </div>            color: white;                                <button class="btn btn-secondary flex-grow-1" onclick="exportarPDF()">

        </div>

        {{/if}}            border: none;                                    <i class="fas fa-file-pdf"></i> Exportar PDF



        <!-- Table Section -->            padding: 0.75rem 1.5rem;                                </button>

        <div class="table-section">

            <div class="table-header">            border-radius: 8px;                            </div>

                <h5 class="mb-0">

                    <i class="bi bi-list-ul me-2"></i>            font-weight: 600;                        </div>

                    Historial Completo de Pagos

                </h5>            display: inline-flex;                    </div>

            </div>

                        align-items: center;

            {{#if pagos.length}}

            <div class="table-responsive">            gap: 0.5rem;                    <!-- Table -->

                <table class="table" id="pagosTable">

                    <thead>            transition: all 0.3s ease;                    <div class="table-responsive">

                        <tr>

                            <th>ID</th>            text-decoration: none;                        <table class="table table-custom table-hover">

                            <th>Fecha</th>

                            <th>Usuario</th>        }                            <thead>

                            <th>Concepto</th>

                            <th>Tipo</th>                                <tr>

                            <th>Monto</th>

                            <th>Estatus</th>        .btn-primary-custom:hover {                                    <th>ID Transacción</th>

                            <th>Acciones</th>

                        </tr>            background: var(--orange-hover);                                    <th>Usuario</th>

                    </thead>

                    <tbody>            transform: translateY(-2px);                                    <th>Concepto</th>

                        {{#each pagos}}

                        <tr>            box-shadow: 0 4px 8px rgba(234, 88, 12, 0.3);                                    <th>Monto</th>

                            <td>

                                <span class="badge bg-secondary">#{{this.id_pago}}</span>            color: white;                                    <th>Método</th>

                            </td>

                            <td>{{formatDate this.fecha_pago}}</td>        }                                    <th>Fecha</th>

                            <td>

                                <div><strong>{{this.usuario_nombre}}</strong></div>                                    <th>Estado</th>

                                <div><small class="text-muted">{{this.usuario_email}}</small></div>

                            </td>        .btn-secondary-custom {                                    <th>Acciones</th>

                            <td>{{this.concepto}}</td>

                            <td>{{this.tipo_pago}}</td>            background: white;                                </tr>

                            <td><strong>${{this.monto}}</strong></td>

                            <td>            color: var(--primary-orange);                            </thead>

                                {{#if (eq this.estatus "exitoso")}}

                                <span class="badge bg-success">            border: 2px solid var(--primary-orange);                            <tbody id="tablaPagos">

                                    <i class="bi bi-check-circle"></i> Exitoso

                                </span>            padding: 0.75rem 1.5rem;                                {{#each pagos}}

                                {{else if (eq this.estatus "fallido")}}

                                <span class="badge bg-danger">            border-radius: 8px;                                <tr data-estado="{{estatus}}" data-metodo="{{metodo_pago}}">

                                    <i class="bi bi-x-circle"></i> Fallido

                                </span>            font-weight: 600;                                    <td><code>{{id_pago}}</code></td>

                                {{else if (eq this.estatus "reembolsado")}}

                                <span class="badge bg-warning">            display: inline-flex;                                    <td>

                                    <i class="bi bi-arrow-counterclockwise"></i> Reembolsado

                                </span>            align-items: center;                                        <div>

                                {{/if}}

                            </td>            gap: 0.5rem;                                            <strong>{{usuario_nombre}}</strong>

                            <td>

                                <div class="actions-group">            transition: all 0.3s ease;                                            <br>

                                    <button type="button" class="btn btn-warning btn-sm" 

                                            onclick="verDetallePago({{this.id_pago}})">            text-decoration: none;                                            <small class="text-muted">{{usuario_email}}</small>

                                        <i class="bi bi-eye"></i>

                                    </button>        }                                        </div>

                                </div>

                            </td>                                    </td>

                        </tr>

                        {{/each}}        .btn-secondary-custom:hover {                                    <td>

                    </tbody>

                </table>            background: var(--orange-lighter);                                        <small>{{concepto}}</small>

            </div>

            {{else}}            transform: translateY(-2px);                                    </td>

            <div class="empty-state">

                <i class="bi bi-credit-card-2-front"></i>            color: var(--primary-orange);                                    <td><strong class="text-success">${{monto}}</strong></td>

                <h4>No hay pagos registrados</h4>

                <p>Cuando se realicen transacciones, aparecerán aquí.</p>        }                                    <td>

            </div>

            {{/if}}                                        <span class="payment-method-badge method-{{metodo_pago}}">

        </div>

    </div>        .btn-action {                                            {{metodo_pago}}



    <!-- Modal Detalle de Pago -->            padding: 0.5rem 1rem;                                        </span>

    <div class="modal fade" id="detalleModal" tabindex="-1">

        <div class="modal-dialog modal-lg">            border-radius: 6px;                                    </td>

            <div class="modal-content">

                <div class="modal-header">            font-size: 0.875rem;                                    <td>{{formatDate fecha}}</td>

                    <h5 class="modal-title">Detalle del Pago</h5>

                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>            font-weight: 500;                                    <td>

                </div>

                <div class="modal-body" id="detalleContent">            border: none;                                        <span class="status-{{estatus}}">{{estatus}}</span>

                    <div class="text-center">

                        <div class="spinner-border text-primary" role="status">            cursor: pointer;                                    </td>

                            <span class="visually-hidden">Cargando...</span>

                        </div>            transition: all 0.3s ease;                                    <td>

                    </div>

                </div>            display: inline-flex;                                        <button class="btn btn-sm btn-info" onclick="verDetalle('{{id_pago}}')" 

            </div>

        </div>            align-items: center;                                                title="Ver detalle">

    </div>

            gap: 0.5rem;                                            <i class="fas fa-eye"></i>

    <!-- Bootstrap JS -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>        }                                        </button>

    

    <script>                                        <button class="btn btn-sm btn-primary" onclick="descargarRecibo('{{id_pago}}')" 

        // Variables globales

        let detalleModal;        .btn-view {                                                title="Descargar recibo">

        

        // Inicializar cuando carga la página            background: var(--orange-lighter);                                            <i class="fas fa-download"></i>

        document.addEventListener('DOMContentLoaded', function() {

            detalleModal = new bootstrap.Modal(document.getElementById('detalleModal'));            color: var(--primary-orange);                                        </button>

        });

                }                                        {{#if (eq estatus 'pendiente')}}

        // Filtrar tabla en tiempo real

        function filtrarTabla() {                                        <button class="btn btn-sm btn-success" onclick="confirmarPago('{{id_pago}}')" 

            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const estatusFilter = document.getElementById('estatusFilter').value.toLowerCase();        .btn-view:hover {                                                title="Confirmar pago">

            const tipoFilter = document.getElementById('tipoFilter').value.toLowerCase();

                        background: var(--primary-orange);                                            <i class="fas fa-check"></i>

            const rows = document.querySelectorAll('#pagosTable tbody tr');

                        color: white;                                        </button>

            rows.forEach(row => {

                const text = row.textContent.toLowerCase();        }                                        {{/if}}

                const estatus = row.querySelector('.badge') ? 

                    row.querySelector('.badge').textContent.toLowerCase() : '';                                    </td>

                const tipo = row.cells[4].textContent.toLowerCase();

                        .empty-state {                                </tr>

                const matchSearch = text.includes(searchTerm);

                const matchEstatus = !estatusFilter || estatus.includes(estatusFilter);            text-align: center;                                {{/each}}

                const matchTipo = !tipoFilter || tipo === tipoFilter.toLowerCase();

                            padding: 3rem;                            </tbody>

                row.style.display = (matchSearch && matchEstatus && matchTipo) ? '' : 'none';

            });            color: var(--medium-gray);                        </table>

        }

                }                    </div>

        // Ver detalle del pago

        async function verDetallePago(id) {

            detalleModal.show();

                    .empty-state i {                    <!-- Pagination -->

            try {

                showLoading(true);            font-size: 4rem;                    <nav>

                

                const response = await fetch(`/admin/pagos/${id}`);            color: var(--border-color);                        <ul class="pagination justify-content-center">

                const pago = await response.json();

                            margin-bottom: 1rem;                            <li class="page-item {{#if primeraPagina}}disabled{{/if}}">

                document.getElementById('detalleContent').innerHTML = `

                    <div class="row g-3">        }                                <a class="page-link" href="?page={{paginaAnterior}}">Anterior</a>

                        <div class="col-md-6">

                            <strong>ID de Pago:</strong> #${pago.id_pago}                            </li>

                        </div>

                        <div class="col-md-6">        .distribucion-grid {                            {{#each paginas}}

                            <strong>Fecha:</strong> ${new Date(pago.fecha_pago).toLocaleString()}

                        </div>            display: grid;                            <li class="page-item {{#if activa}}active{{/if}}">

                        <div class="col-md-6">

                            <strong>Usuario:</strong> ${pago.usuario_nombre}            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));                                <a class="page-link" href="?page={{numero}}">{{numero}}</a>

                        </div>

                        <div class="col-md-6">            gap: 1rem;                            </li>

                            <strong>Email:</strong> ${pago.usuario_email}

                        </div>            margin-top: 1rem;                            {{/each}}

                        <div class="col-md-6">

                            <strong>Concepto:</strong> ${pago.concepto}        }                            <li class="page-item {{#if ultimaPagina}}disabled{{/if}}">

                        </div>

                        <div class="col-md-6">                                <a class="page-link" href="?page={{paginaSiguiente}}">Siguiente</a>

                            <strong>Monto:</strong> $${pago.monto}

                        </div>        .distribucion-item {                            </li>

                        <div class="col-md-6">

                            <strong>Estatus:</strong> ${pago.estatus}            background: var(--light-gray);                        </ul>

                        </div>

                        <div class="col-md-6">            padding: 1rem;                    </nav>

                            <strong>ID Compra:</strong> ${pago.id_compra || 'N/A'}

                        </div>            border-radius: 8px;                </div>

                        <div class="col-md-6">

                            <strong>ID Suscripción:</strong> ${pago.id_suscripcion || 'N/A'}            text-align: center;            </div>

                        </div>

                    </div>        }

                `;

            } catch (error) {            <div class="col-lg-4">

                document.getElementById('detalleContent').innerHTML = `

                    <div class="alert alert-danger">        .distribucion-item .label {                <div class="content-card">

                        Error al cargar los detalles del pago

                    </div>            font-size: 0.875rem;                    <h3 class="mb-4"><i class="fas fa-chart-pie"></i> Ingresos por Método</h3>

                `;

            } finally {            color: var(--medium-gray);                    <div class="chart-container">

                showLoading(false);

            }            margin-bottom: 0.5rem;                        <canvas id="metodosPagoChart"></canvas>

        }

                }                    </div>

        // Mostrar/ocultar loading

        function showLoading(show) {                    {{#each metodosPago}}

            const overlay = document.getElementById('loadingOverlay');

            overlay.style.display = show ? 'flex' : 'none';        .distribucion-item .value {                    <div class="d-flex justify-content-between mb-2">

        }

    </script>            font-size: 1.5rem;                        <span class="payment-method-badge method-{{metodo}}">{{metodo}}</span>

</body>

</html>            font-weight: 700;                        <strong>${{total}}</strong>

            color: var(--dark-gray);                    </div>

        }                    {{/each}}

                </div>

        .distribucion-item .monto {

            font-size: 0.875rem;                <div class="content-card">

            color: var(--medium-gray);                    <h3 class="mb-4"><i class="fas fa-chart-line"></i> Ingresos por Mes</h3>

            margin-top: 0.25rem;                    <div class="chart-container">

        }                        <canvas id="ingresosMensualesChart"></canvas>

                    </div>

        @media (max-width: 768px) {                </div>

            body {

                padding: 1rem;                <div class="content-card">

            }                    <h3 class="mb-4"><i class="fas fa-trophy"></i> Top Compradores</h3>

                    <div class="list-group">

            .header h1 {                        {{#each topCompradores}}

                font-size: 1.5rem;                        <div class="list-group-item">

            }                            <div class="d-flex justify-content-between align-items-center">

                                <div>

            .stats-grid {                                    <strong>{{nombre}}</strong>

                grid-template-columns: 1fr;                                    <br>

            }                                    <small class="text-muted">{{cantidad_compras}} compras</small>

                                </div>

            .filters-section {                                <strong class="text-success">${{total}}</strong>

                flex-direction: column;                            </div>

            }                        </div>

                        {{/each}}

            .search-box {                    </div>

                min-width: 100%;                </div>

            }

                <div class="content-card">

            .table {                    <h3 class="mb-4"><i class="fas fa-exclamation-triangle"></i> Pagos Pendientes</h3>

                font-size: 0.875rem;                    <div class="alert alert-warning">

            }                        <strong>{{pagosPendientes}}</strong> pagos pendientes de confirmación

        }                        <br>

    </style>                        <small>Total: ${{totalPendiente}}</small>

</head>                    </div>

<body>                    <button class="btn btn-warning w-100" onclick="verPendientes()">

    <div class="container-fluid">                        <i class="fas fa-clock"></i> Ver Todos los Pendientes

        <!-- Header -->                    </button>

        <div class="header">                </div>

            <h1>            </div>

                <i class="bi bi-credit-card-2-front"></i>        </div>

                Historial de Pagos    </div>

            </h1>

        </div>    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Stats Cards -->    <script>

        <div class="stats-grid">        function filtrarPagos() {

            <div class="stat-card">            const estado = document.getElementById('filtroEstado').value;

                <div class="stat-label">Total Ingresos</div>            const metodo = document.getElementById('filtroMetodo').value;

                <div class="stat-value">            const filas = document.querySelectorAll('#tablaPagos tr');

                    <div class="stat-icon">

                        <i class="bi bi-currency-dollar"></i>            filas.forEach(fila => {

                    </div>                const matchEstado = !estado || fila.dataset.estado === estado;

                    <span>${{totalIngresos}}</span>                const matchMetodo = !metodo || fila.dataset.metodo === metodo;

                </div>                fila.style.display = (matchEstado && matchMetodo) ? '' : 'none';

            </div>            });

        }

            <div class="stat-card">

                <div class="stat-label">Ingresos Este Mes</div>        function buscar() {

                <div class="stat-value">            const busqueda = document.getElementById('buscarTransaccion').value.toLowerCase();

                    <div class="stat-icon">            const filas = document.querySelectorAll('#tablaPagos tr');

                        <i class="bi bi-calendar-month"></i>

                    </div>            filas.forEach(fila => {

                    <span>${{ingresosMes}}</span>                const texto = fila.textContent.toLowerCase();

                </div>                fila.style.display = texto.includes(busqueda) ? '' : 'none';

            </div>            });

        }

            <div class="stat-card">

                <div class="stat-label">Total Transacciones</div>        function verDetalle(pagoId) {

                <div class="stat-value">            window.location.href = `/admin/pagos/${pagoId}`;

                    <div class="stat-icon">        }

                        <i class="bi bi-receipt"></i>

                    </div>        function descargarRecibo(pagoId) {

                    <span>{{totalTransacciones}}</span>            window.location.href = `/admin/pagos/${pagoId}/recibo`;

                </div>        }

            </div>

        function confirmarPago(pagoId) {

            <div class="stat-card">            if (confirm('¿Confirmar este pago?')) {

                <div class="stat-label">Tasa de Éxito</div>                fetch(`/admin/pagos/${pagoId}/confirmar`, {

                <div class="stat-value">                    method: 'POST',

                    <div class="stat-icon">                    headers: {'Content-Type': 'application/json'}

                        <i class="bi bi-check-circle"></i>                })

                    </div>                .then(response => response.json())

                    <span>{{tasaExito}}%</span>                .then(data => {

                </div>                    if (data.success) {

            </div>                        alert('Pago confirmado');

        </div>                        location.reload();

                    }

        <!-- Distribución por Estatus -->                });

        {{#if distribucionEstatus}}            }

        <div class="content-card">        }

            <div class="card-header-custom">

                <h2 class="card-title">Distribución por Estatus</h2>        function exportarExcel() {

            </div>            window.location.href = '/admin/pagos/exportar/excel';

            <div class="distribucion-grid">        }

                {{#each distribucionEstatus}}

                <div class="distribucion-item">        function exportarPDF() {

                    <div class="label">{{this.estatus}}</div>            window.location.href = '/admin/pagos/exportar/pdf';

                    <div class="value">{{this.cantidad}}</div>        }

                    <div class="monto">${{this.total}}</div>

                </div>        function verPendientes() {

                {{/each}}            window.location.href = '/admin/pagos?estado=pendiente';

            </div>        }

        </div>    </script>

        {{/if}}</body>

</html>
        <!-- Top Compradores -->
        {{#if topCompradores}}
        <div class="content-card">
            <div class="card-header-custom">
                <h2 class="card-title">Top 10 Compradores</h2>
            </div>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Transacciones</th>
                            <th>Total Gastado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each topCompradores}}
                        <tr>
                            <td><strong>{{this.nombre}}</strong></td>
                            <td>{{this.email}}</td>
                            <td>{{this.cantidad_transacciones}}</td>
                            <td><strong>${{this.total_gastado}}</strong></td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
        {{/if}}

        <!-- Tabla de Pagos -->
        <div class="content-card">
            <div class="card-header-custom">
                <h2 class="card-title">Historial Completo</h2>
                <a href="/dashboard" class="btn-secondary-custom">
                    <i class="bi bi-arrow-left"></i>
                    Volver al Dashboard
                </a>
            </div>

            <!-- Filtros -->
            <div class="filters-section">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Buscar por usuario, email, concepto..." class="form-control">
                </div>
                <select id="estatusFilter" class="filter-select">
                    <option value="">Todos los Estatus</option>
                    <option value="exitoso">Exitoso</option>
                    <option value="fallido">Fallido</option>
                    <option value="reembolsado">Reembolsado</option>
                </select>
                <select id="tipoFilter" class="filter-select">
                    <option value="">Todos los Tipos</option>
                    <option value="Compra de Curso">Compra de Curso</option>
                    <option value="Suscripción">Suscripción</option>
                    <option value="Otro">Otro</option>
                </select>
            </div>

            <!-- Tabla -->
            {{#if pagos.length}}
            <div class="table-responsive">
                <table class="table" id="pagosTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Fecha</th>
                            <th>Usuario</th>
                            <th>Concepto</th>
                            <th>Tipo</th>
                            <th>Monto</th>
                            <th>Estatus</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each pagos}}
                        <tr>
                            <td><strong>#{{this.id_pago}}</strong></td>
                            <td>{{formatDate this.fecha_pago}}</td>
                            <td>
                                <div><strong>{{this.usuario_nombre}}</strong></div>
                                <div style="font-size: 0.875rem; color: var(--medium-gray);">{{this.usuario_email}}</div>
                            </td>
                            <td>{{this.concepto}}</td>
                            <td>{{this.tipo_pago}}</td>
                            <td><strong>${{this.monto}}</strong></td>
                            <td>
                                {{#if (eq this.estatus "exitoso")}}
                                <span class="badge-status badge-exitoso">
                                    <i class="bi bi-check-circle"></i> Exitoso
                                </span>
                                {{else if (eq this.estatus "fallido")}}
                                <span class="badge-status badge-fallido">
                                    <i class="bi bi-x-circle"></i> Fallido
                                </span>
                                {{else if (eq this.estatus "reembolsado")}}
                                <span class="badge-status badge-reembolsado">
                                    <i class="bi bi-arrow-counterclockwise"></i> Reembolsado
                                </span>
                                {{/if}}
                            </td>
                            <td>
                                <button class="btn-action btn-view" onclick="verDetallePago({{this.id_pago}})">
                                    <i class="bi bi-eye"></i> Ver
                                </button>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            {{else}}
            <div class="empty-state">
                <i class="bi bi-inbox"></i>
                <h3>No hay pagos registrados</h3>
                <p>Cuando se realicen transacciones, aparecerán aquí.</p>
            </div>
            {{/if}}
        </div>
    </div>

    <!-- Modal Detalle de Pago -->
    <div class="modal fade" id="detalleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detalle del Pago</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detalleContent">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Filtros en tiempo real
        document.getElementById('searchInput').addEventListener('input', filtrarTabla);
        document.getElementById('estatusFilter').addEventListener('change', filtrarTabla);
        document.getElementById('tipoFilter').addEventListener('change', filtrarTabla);

        function filtrarTabla() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const estatusFilter = document.getElementById('estatusFilter').value.toLowerCase();
            const tipoFilter = document.getElementById('tipoFilter').value.toLowerCase();
            
            const rows = document.querySelectorAll('#pagosTable tbody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const estatus = row.querySelector('.badge-status') ? 
                    row.querySelector('.badge-status').textContent.toLowerCase() : '';
                const tipo = row.cells[4].textContent.toLowerCase();
                
                const matchSearch = text.includes(searchTerm);
                const matchEstatus = !estatusFilter || estatus.includes(estatusFilter);
                const matchTipo = !tipoFilter || tipo === tipoFilter.toLowerCase();
                
                row.style.display = (matchSearch && matchEstatus && matchTipo) ? '' : 'none';
            });
        }

        // Ver detalle del pago
        async function verDetallePago(id) {
            const modal = new bootstrap.Modal(document.getElementById('detalleModal'));
            modal.show();
            
            try {
                const response = await fetch(`/admin/pagos/${id}`);
                const pago = await response.json();
                
                document.getElementById('detalleContent').innerHTML = `
                    <div class="row g-3">
                        <div class="col-md-6">
                            <strong>ID de Pago:</strong> #${pago.id_pago}
                        </div>
                        <div class="col-md-6">
                            <strong>Fecha:</strong> ${new Date(pago.fecha_pago).toLocaleString()}
                        </div>
                        <div class="col-md-6">
                            <strong>Usuario:</strong> ${pago.usuario_nombre}
                        </div>
                        <div class="col-md-6">
                            <strong>Email:</strong> ${pago.usuario_email}
                        </div>
                        <div class="col-md-6">
                            <strong>Concepto:</strong> ${pago.concepto}
                        </div>
                        <div class="col-md-6">
                            <strong>Monto:</strong> $${pago.monto}
                        </div>
                        <div class="col-md-6">
                            <strong>Estatus:</strong> ${pago.estatus}
                        </div>
                        <div class="col-md-6">
                            <strong>ID Compra:</strong> ${pago.id_compra || 'N/A'}
                        </div>
                        <div class="col-md-6">
                            <strong>ID Suscripción:</strong> ${pago.id_suscripcion || 'N/A'}
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('detalleContent').innerHTML = `
                    <div class="alert alert-danger">
                        Error al cargar los detalles del pago
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
